<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Sequência WebP – Estável</title>
<style>
html,body{
  margin:0;
  background:#000;
  width:100%;
  height:100%;
  overflow:hidden;
}
canvas{
  width:100%;
  height:100%;
  display:block;
}
#msg{
  position:fixed;
  bottom:10px;
  left:10px;
  color:#0f0;
  font:12px monospace;
}
</style>
</head>
<body>

<canvas id="c"></canvas>
<div id="msg">Carregando…</div>

<script>
const PATH = 'assets/';
const PREFIX = 'frame-';
const EXT = 'webp';
const MAX = 100;
const FPS = 12;

const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
const msg = document.getElementById('msg');

canvas.width = innerWidth;
canvas.height = innerHeight;
addEventListener('resize',()=>{
  canvas.width = innerWidth;
  canvas.height = innerHeight;
});

const frames = [];
let i = 1;

function load(){
  if(i > MAX){
    start();
    return;
  }

  const num = String(i).padStart(3,'0');
  const img = new Image();

  img.onload = ()=>{
    if(img.width > 0){
      frames.push(img);
    }
    i++;
    load();
  };

  img.onerror = ()=>{
    i++;
    load();
  };

  img.src = `${PATH}${PREFIX}${num}.${EXT}`;
}

let idx = 0;
let last = 0;
const interval = 1000 / FPS;

function loop(t){
  if(frames.length === 0){
    msg.innerText = 'ERRO: nenhum frame encontrado';
    return;
  }

  if(t - last >= interval){
    last = t;

    const img = frames[idx];
    ctx.clearRect(0,0,canvas.width,canvas.height);

    const s = Math.min(
      canvas.width / img.width,
      canvas.height / img.height
    );

    const w = img.width * s;
    const h = img.height * s;

    ctx.drawImage(
      img,
      (canvas.width - w)/2,
      (canvas.height - h)/2,
      w,h
    );

    idx++;
    if(idx >= frames.length - 1){
      idx = 0; // loop perfeito
    }
  }

  requestAnimationFrame(loop);
}

function start(){
  msg.innerText = `Frames carregados: ${frames.length}`;
  requestAnimationFrame(loop);
}

load();
</script>

</body>
</html>
