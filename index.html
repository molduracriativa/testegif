<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Animação WebP – Estável</title>
<style>
html,body{
  margin:0;
  padding:0;
  background:#000;
  width:100%;
  height:100%;
  overflow:hidden;
}
canvas{
  display:block;
  width:100%;
  height:100%;
}
#debug{
  position:fixed;
  bottom:10px;
  left:10px;
  color:#0f0;
  font-family:monospace;
  font-size:12px;
}
</style>
</head>
<body>

<canvas id="canvas"></canvas>
<div id="debug">Carregando frames…</div>

<script>
/* ===== CONFIG ===== */
const FPS = 12;
const PATH = 'assets/';
const PREFIX = 'frame-';
const EXT1 = 'webp';
const EXT2 = 'png';
const MAX = 200;
/* ================== */

const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const debug = document.getElementById('debug');

const frames = [];
let index = 0;
let last = 0;
const interval = 1000 / FPS;

function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
addEventListener('resize', resize);
resize();

/* ===== LOAD ===== */
let i = 1;

function loadNext(){
  if(i > MAX){
    finalizeLoad();
    return;
  }

  const num = String(i).padStart(3,'0');
  const img = new Image();

  img.onload = ()=>{
    if(img.width > 0){
      frames.push(img);
    }
    i++;
    loadNext();
  };

  img.onerror = ()=>{
    const fb = new Image();
    fb.onload = ()=>{
      if(fb.width > 0){
        frames.push(fb);
      }
      i++;
      loadNext();
    };
    fb.onerror = ()=>{
      i++;
      loadNext();
    };
    fb.src = `${PATH}${PREFIX}${num}.${EXT2}`;
  };

  img.src = `${PATH}${PREFIX}${num}.${EXT1}`;
}

function finalizeLoad(){
  debug.innerText = `Frames carregados: ${frames.length}`;

  if(frames.length < 1){
    debug.innerText = 'ERRO: nenhum frame encontrado';
    return;
  }

  requestAnimationFrame(loop);
}

/* ===== LOOP ===== */
function loop(t){
  if(t - last >= interval){
    last = t;

    const img = frames[index];
    if(img && img.width > 0){
      ctx.clearRect(0,0,canvas.width,canvas.height);

      const s = Math.min(
        canvas.width / img.width,
        canvas.height / img.height
      );

      const w = img.width * s;
      const h = img.height * s;

      ctx.drawImage(
        img,
        (canvas.width - w)/2,
        (canvas.height - h)/2,
        w,h
      );

      index++;
      if(index >= frames.length - 1){
        index = 0;
      }
    }
  }

  requestAnimationFrame(loop);
}

loadNext();
</script>

</body>
</html>
