<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Animação Sequencial WebP</title>
<style>
  html,body{
    margin:0;
    padding:0;
    background:#000;
    width:100%;
    height:100%;
    overflow:hidden;
  }
  canvas{
    display:block;
    width:100%;
    height:100%;
  }
</style>
</head>
<body>

<canvas id="canvas"></canvas>

<script>
/* ================= CONFIGURAÇÕES ================= */
const FPS = 30;                // 30 ou 60
const FRAME_PREFIX = 'frame-'; // frame-001.webp
const MAX_FRAMES = 999;
const PATH = 'assets/';
const EXT_PRIMARY = 'webp';
const EXT_FALLBACK = 'png';
/* ================================================ */

const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const frames = [];

let frameIndex = 0;
let lastTime = 0;
const frameInterval = 1000 / FPS;

/* ===== AJUSTE DE CANVAS ===== */
function resize(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

/* ===== CARREGAMENTO AUTOMÁTICO ===== */
function loadFrames(){
  let i = 1;

  function loadNext(){
    if(i > MAX_FRAMES){
      start();
      return;
    }

    const index = String(i).padStart(3,'0');
    const img = new Image();

    img.src = `${PATH}${FRAME_PREFIX}${index}.${EXT_PRIMARY}`;

    img.onload = ()=>{
      frames.push(img);
      i++;
      loadNext();
    };

    img.onerror = ()=>{
      // fallback PNG
      const fallback = new Image();
      fallback.src = `${PATH}${FRAME_PREFIX}${index}.${EXT_FALLBACK}`;

      fallback.onload = ()=>{
        frames.push(fallback);
        i++;
        loadNext();
      };

      fallback.onerror = ()=>{
        // frame inexistente → ignora e segue
        i++;
        loadNext();
      };
    };
  }

  loadNext();
}

/* ===== LOOP PERFEITO ===== */
function draw(time){
  if(frames.length < 2) return;

  if(time - lastTime >= frameInterval){
    lastTime = time;

    ctx.clearRect(0,0,canvas.width,canvas.height);

    const img = frames[frameIndex];

    const scale = Math.min(
      canvas.width / img.width,
      canvas.height / img.height
    );

    const w = img.width * scale;
    const h = img.height * scale;
    const x = (canvas.width - w) / 2;
    const y = (canvas.height - h) / 2;

    ctx.drawImage(img, x, y, w, h);

    frameIndex++;

    // LOOP PERFEITO REAL
    if(frameIndex >= frames.length - 1){
      frameIndex = 0;
    }
  }

  requestAnimationFrame(draw);
}

/* ===== INICIAR ===== */
function start(){
  console.log('Frames carregados:', frames.length);
  requestAnimationFrame(draw);
}

loadFrames();
</script>

</body>
</html>
